# 导入自定义镜像

在云上部署业务时，您可以手动导入服务器的镜像文件，也可以由阿里云自动为您的服务器生成ECS镜像。本文介绍这两种方法的应用场景和操作步骤。

手动导入镜像前，请确认您已完成以下操作：

-   了解镜像限制和要求，详情请参见[导入镜像必读](/cn.zh-CN/镜像/自定义镜像/导入镜像/导入镜像必读.md)、[定制Linux自定义镜像](/cn.zh-CN/镜像/自定义镜像/导入镜像/定制Linux自定义镜像.md)和[转换镜像格式](/cn.zh-CN/镜像/自定义镜像/导入镜像/转换镜像格式.md)。
-   [开通OSS服务](/cn.zh-CN/快速入门/开通OSS服务.md)。
-   如果您使用的是RAM子账号，应预先联系主账号授权[AliyunECSImageImportDefaultRole](https://ram.console.aliyun.com/#/role/detail/AliyunECSImageImportDefaultRole/info)角色策略获得操作许可。

导入自定义镜像的应用场景如下：

|功能|应用场景|操作步骤|
|--|----|----|
|自动导入|将一台或多台服务器（包括IDC服务器、虚拟机、其他云平台的云主机或其他类型的服务器）迁移至阿里云。|[自动导入](#section_1pv_ejb_kfo)|
|手动导入|阿里云没有可用的操作系统类型供您选择。例如： -   服务器的操作系统类型在阿里云不存在。
-   服务器操作系统版本在阿里云已下线。
-   服务器的操作系统为线下定制系统。

手动导入自定义镜像功能，支持设置不同的许可证类型激活源操作系统，以降低您在云上使用镜像的费用。许可证类型详情，请参见[导入镜像参数说明表](#table_qd4_wqe_2yq)。

|[手动导入](#section_yqm_q6o_p0q)|

## 自动导入

完成以下操作，由服务器迁移中心SMC为您的源服务器生成ECS镜像。

1.  登录[ECS管理控制台](https://ecs.console.aliyun.com)。

2.  在左侧导航栏，单击**实例与镜像** \> **镜像**。

3.  在顶部菜单栏左上角处，选择地域。

4.  在**镜像列表**页的右上角，单击**导入镜像** \> **自动导入**。

    页面跳转至**服务器迁移中心SMC控制台**。

5.  完成SMC所需操作。具体步骤，请参见[迁移流程概述](/cn.zh-CN/用户指南/迁移流程概述.md)。

    迁移完成后，SMC会为您的服务器生成一份自定义镜像。镜像名称以`IMAGE_FROM_SMC`开头。


## 手动导入

完成以下操作，将服务器的本地镜像文件导入阿里云ECS。

1.  使用OSS的第三方工具客户端或API上传制作好的自定义镜像。关于如何上传大于5 GiB的文件，请参见[OSS分片上传和断点续传](/cn.zh-CN/开发指南/对象/文件（Object）/上传文件（Object）/分片上传和断点续传.md)。

2.  登录[ECS管理控制台](https://ecs.console.aliyun.com)。

3.  在左侧导航栏，单击**实例与镜像** \> **镜像**。

4.  在顶部菜单栏左上角处，选择地域。

5.  授权ECS服务访问您的OSS资源。

    1.  在**镜像列表**页面右上角，单击**导入镜像** \> **手动导入**。

    2.  在**导入镜像**对话框里，单击提示信息第3步中的**确认地址**。

        ![](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/3073559951/p7027.png)

    3.  在**云资源访问授权**页面，选中`AliyunECSImageImportDefaultRole`和`AliyunECSExportDefaultRole`，单击**同意授权**。

6.  导入自定义镜像。

    1.  在**镜像列表**页面右上角，再次单击**导入镜像** \> **手动导入**。

    2.  在**导入镜像**对话框里，完成以下设置。

        |参数|是否必填|说明|
        |--|----|--|
        |**镜像所在地域**|是|由系统自动设置为当前地域。如需更换地域，请在顶部菜单栏选择新的地域，并重新打开**导入镜像**对话框。|
        |**OSS Object 地址**|是|填写从OSS控制台获取的镜像文件Object地址。更多详情，请参见[下载文件](/cn.zh-CN/控制台用户指南/文件管理/下载文件.md)。|
        |**镜像名称**|是|镜像文件导入后显示的名称。长度为2~128个字符，以大小写字母或中文开头，可包含数字、英文句号（.）、下划线（\_）、半角冒号（:）和连字符（-）。|
        |**操作系统**|是|选择待导入镜像的操作系统类型。取值范围：**Windows**\|**Linux**。 待导入镜像的操作系统为非标准平台时，应选择**Linux**。 |
        |**系统盘大小（GiB）**|否|系统盘大小范围为5 GiB~500 GiB。|
        |**系统架构**|是|64位操作系统选择**x86\_64**，32位操作系统选择**i386**。|
        |**系统平台**|是|列表的值取决于**操作系统**的值。选择适用于待导入镜像的系统平台。         -   Windows：支持Windows Server 2003、Windows Server 2008、Windows Server 2012、Windows Server 2016和Windows Server 2019。
        -   Linux：支持CentOS、SUSE、OpenSUSE、Ubuntu、Debian、FreeBSD、CoreOS、Aliyun、RedHat、Customized Linux和Others Linux（请[提交工单](https://selfservice.console.aliyun.com/ticket/createIndex.htm)确认是否支持）。
        -   如果您的镜像的操作系统是根据Linux内核定制开发的，请[提交工单](https://selfservice.console.aliyun.com/ticket/createIndex.htm)联系我们。 |
        |**镜像格式**|否|仅支持RAW，QCOW2和VHD格式，推荐使用传输内容更小的QCOW2或者VHD格式。 **说明：** 不支持ISO镜像文件，需先转换成RAW、VHD或QCOW2格式再导入。您也可以使用Packer创建并导入本地镜像，详情请参见[使用Packer创建并导入本地镜像](/cn.zh-CN/镜像/自定义镜像/创建自定义镜像/使用Packer创建并导入本地镜像.md)和[Packer的DevOps配置](/cn.zh-CN/最佳实践/自定义镜像构建实践/Packer实践之镜像即代码/Packer的DevOps配置.md)。 |
        |**许可证类型**|否|镜像导入之后，激活源操作系统要使用的许可证类型。取值范围：         -   **自带许可**：源操作系统自带的许可证。采用自带许可时，需确保您的许可证密钥能够在阿里云使用。
        -   **阿里云**：根据您设置的**系统平台**值，采用阿里云官方渠道许可证。
        -   **自动**（默认值）：由阿里云自动检测源操作系统并分配许可证。自动模式下，系统会自动搜索您设置的**系统平台**是否有阿里云官方渠道许可证，并做如下处理：
            -   如果有阿里云官方许可证，则分配给导入的镜像。
            -   如果没有该类许可，则切换成**自带许可**方式。 |
        |**镜像描述**|否|填写镜像描述信息，便于后续管理。|
        |**添加数据盘镜像**|否|同时导入包含数据盘的自定义镜像，支持的数据盘容量范围为5 GiB~1000 GiB。|
        |**资源组**|否|您可以设置资源组，对镜像进行分级管理。|
        |**标签**|否|您可以设置标签，将镜像归类，便于搜索与批量操作。|

    3.  信息确认无误后，单击**确定**。系统会创建一个导入自定义镜像的任务。

7.  在目标地域的镜像列表中查看导入进度。在任务完成前，您都可以通过任务管理找到该导入的自定义镜像，取消导入镜像任务。详情请参见[任务管理](https://ecs.console.aliyun.com/#/task/region/)。

    导入自定义镜像所需时间，取决于镜像文件的大小和当前导入任务的并发数，需要您耐心等待。

    导入自定义镜像时，系统会自动生成一份快照，您可以在**快照列表**里看到快照信息。导入镜像任务未完成前，快照的状态会显示为**失败**。任务完成后，快照和镜像的状态均会自动更新为**可用**。快照的容量为导入的自定义镜像文件大小，与导入自定义镜像时设置的系统盘大小无关。目前快照容量已经收费，详情请参见[快照计费方式](/cn.zh-CN/产品定价/计费项/快照计费.md)。


[使用自定义镜像创建实例](/cn.zh-CN/实例/创建实例/使用自定义镜像创建实例.md)

**相关文档**  


[ImportImage](/cn.zh-CN/API参考/镜像/ImportImage.md)

[使用Packer创建并导入本地镜像](/cn.zh-CN/镜像/自定义镜像/创建自定义镜像/使用Packer创建并导入本地镜像.md)

[更换操作系统](/cn.zh-CN/镜像/更换操作系统.md)

[镜像FAQ](/cn.zh-CN/镜像/镜像FAQ.md)

[什么是服务器迁移中心](/cn.zh-CN/产品简介/什么是服务器迁移中心.md)

