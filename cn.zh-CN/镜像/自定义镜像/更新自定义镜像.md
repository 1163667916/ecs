---
keyword: [OOS, 自动化运维, 创建镜像, 补丁升级, ecs, 应用更新, 弹性]
---

# 更新自定义镜像

运维编排服务OOS为更新自定义镜像的场景提供了公共模版。您只需选择一个源镜像，输入更新镜像所需的云助手脚本等必要参数，就可以创建立即执行或定时执行的运维任务，一键更新自定义镜像。

更新自定义镜像会自动创建临时资源并采用按量付费计费方式，您的账号余额不能小于100元。

在更新自定义镜像的完整流程中，运维编排服务OOS的ACS-ECS-UpdateImage公共模板按顺序执行以下任务，并生成新的自定义镜像：

1.  检查新自定义镜像的名称是否已存在，以及是否符合规则。
2.  根据您配置的实例规格、源镜像ID、安全组ID等参数创建并运行一台临时ECS实例。
3.  检查临时ECS实例是否安装了云助手客户端，若缺失则安装云助手客户端。
4.  在临时ECS实例上，通过云助手执行脚本更新实例系统环境。

    **说明：** 运维编排服务OOS通过调用云助手API执行Shell、Bat或者PowerShell等脚本，更新ECS实例的系统应用环境。更多详情，请参见[云助手概述](/cn.zh-CN/运维与监控/云助手/云助手概述.md)。

5.  停止临时ECS实例。
6.  根据临时ECS实例创建自定义镜像。
7.  释放临时ECS实例。

1.  登录[ECS管理控制台](https://ecs.console.aliyun.com)。

2.  在左侧导航栏，单击**实例与镜像** \> **镜像**。

3.  在顶部菜单栏左上角处，选择地域。

4.  在**镜像列表**页签下，选择**自定义镜像**，找到目标镜像，在**操作**栏选择**更多** \> **更新镜像**。

    ![使用OOS更新自定义镜像](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/4073559951/p64966.png)

5.  跳转至OOS管理控制台后，完成以下操作：

    1.  保持**基本信息**的默认设置，单击**下一步：设置参数**。

    2.  完成**参数设置**填写，用以自动化创建或更新自定义镜像运维任务，参数含义如下表所示。

        |参数|说明|示例|
        |--|--|--|
        |targetImageName|更新的自定义镜像的名称，必须满足正则表达式/^\[A-Za-z0-9\\-\_\]\*$/要求，且不能和已有镜像名称重名。|add\_testtxt\_20191010|
        |sourceImageId|待更新的源镜像ID。 **说明：** 如果您还未创建过自定义镜像，可以使用公共镜像ID，例如centos\_7\_06\_64\_20G\_alibase\_20190711.vhd。

|m-bp13y4of6mdoqw\*\*\*\*\*\*|
        |instanceType|用以创建临时ECS实例的实例规格，取值请参见[实例规格族](/cn.zh-CN/实例/实例规格族.md)。|ecs.g5.xlarge|
        |securityGroupId|用以创建临时ECS实例的安全组ID。|sg-bp1azkttqpldxg\*\*\*\*\*\*|
        |vSwitchId|用以创建临时ECS实例的交换机ID。指定的虚拟交换机必须和安全组在同一个专有网络VPC中。|vsw-bp1s5fnvk4gn2tw\*\*\*\*\*\*|
        |ramRoleName|实例的RAM角色。|TestRAMRole|
        |commandType|云助手脚本类型：         -   RunShellScript：Linux实例适用的Shell脚本。
        -   RunBatScript：Windows实例适用的Bat脚本。
        -   RunPowerShellScript：Windows实例适用的PowerShell脚本。
|RunShellScript|
        |tags|镜像标签。        -   **标签键（必选）**：镜像的标签键。
        -   **标签值（可选）**：镜像的标签值。
        -   （默认设置）**将资源的标签同时打到该执行上**：将资源的标签绑定到该OOS模板。执行后，可以方便您在列表页通过标签过滤标签资源对应的执行结果。
|        -   标签键：ECS
        -   标签值：Image |
        |commandContent|在临时ECS实例中执行的脚本内容。|        ```
echo "hello world" >/root/test.txt.
        ``` |
        |**执行使用到的权限的来源**|可选参数。         -   （默认设置）**当前账号的已有权限**：执行您使用的账号的权限动作。请确保您拥有创建自定义镜像涉及的所有ECS API调用权限。
        -   **指定RAM角色，使用该角色的权限**：如果指定了RAM角色名称，OOS扮演该RAM角色执行运维任务。
|**当前账号的已有权限**|

    3.  单击**下一步：确定**。

    4.  查看运维任务详情以及风险操作，确认无误后单击**确认风险并执行**。

6.  在**执行管理**中查看创建的运维任务。


若成功创建运维任务，且执行状态处于**运行中**，则表示更新自定义镜像正在进行中。当**执行状态**转换为**成功**时，则表示镜像更新成功，您可以在执行详情中查看新镜像ID。

![更新镜像结果](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/5073559951/p64664.png)

**说明：** 如需了解更新自定义镜像的详细过程，您可单击该执行的**详情**，查看**执行日志**，了解运维任务的实时进度和状态。

**相关文档**  


[什么是运维编排服务](https://help.aliyun.com/document_detail/120556.htm)

[使用运维编排创建和更新自定义镜像](https://help.aliyun.com/document_detail/140103.htm)

