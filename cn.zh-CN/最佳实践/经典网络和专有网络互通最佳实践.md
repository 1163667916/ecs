# 经典网络和专有网络互通最佳实践

经典网络和专有网络互通可以通过建立ClassicLink连接实现网络互通，也可以将经典网络迁移至专有网络后，通过云企业网实现专有网络的互通。本教程介绍如何将多台经典网络类型的ECS实例迁移至专有网络，并和新创建的专有网络类型的ECS实例实现互通。

确保经典网络类型的ECS实例符合以下条件：

-   不能是挂载了本地盘的实例规格族。
-   ECS实例不在华东1（杭州）地域的可用区C内，该可用区的部分ECS实例不支持迁移网络类型。
-   您业务需求的应用服务均已设置为开机自启动。
-   检查业务需求的软件，是否采用绑定网卡MAC地址注册合法环境。由于迁移专有网络VPC后公网网卡会被移除，因此网卡MAC地址会丢失。此时，您可以联系软件供应商确认所使用的软件是否通过绑定网卡MAC地址注册了您的ECS实例，如果是则需要重新绑定到ECS实例主网卡。

在正式操作前，请确保您已了解以下注意事项及使用限制：

-   ECS实例从经典网络迁移至专有网络的注意事项，请参见[经典网络迁移至专有网络](/cn.zh-CN/网络/经典网络迁移至专有网络.md)中背景信息章节。
-   云企业网的使用限制，请参见[使用限制]()。

本教程中使用如下资源作为示例：

![Resources](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/4747230061/p167235.png)

-   两台经典网络类型的ECS实例：`ECS-1`和`ECS-2`
-   一台专有网络类型的ECS实例：`ECS-3`
-   新创建的VPC：`VPC-1`
-   一台专有网络类型的ECS实例对应的VPC：`VPC-2`

通过以下步骤实现网络互通：

1.  在经典网络类型的ECS实例所在的地域可用区下创建专有网络VPC，示例名称`VPC-1`，网段需要匹配经典网络的IPv4地址。
2.  将经典网络类型的ECS实例迁移至专有网络类型的ECS实例。
3.  通过绑定云企业网的方式实现`VPC-1`与`VPC-2`网络互通。

本教程中的示例场景为同账号同地域，因此不需要配置云企业网的互通带宽等功能。如果您的互通需求需要跨账号跨地域，也可以通过云企业网实现。详情请参见[云企业网]()。

如果您的云资源均在同一个账号的同一个地域下，并且业务需求较少，不需要将经典网络迁移至专有网络，您可以使用ClassicLink功能实现经典网络和专有网络互通，详情请参见[经典网络和专有网络互通](/cn.zh-CN/网络/经典网络和专有网络互通.md)。

## 步骤一：创建专有网络VPC

为将要迁移的经典网络类型的ECS实例`ECS-1`和`ECS-2`创建示例名称为`VPC-1`的VPC。

1.  登录[专有网络管理控制台](https://vpcnext.console.aliyun.com)。

2.  选择与经典网络类型的ECS实例相同的地域。

3.  单击**创建专有网络**。

4.  **IPv4网段**的配置项中，单击**推荐网段**，并选择**10.0.0.0/8**网段。

    选择的网段需要和经典网络类型的ECS实例的私网IP保持匹配。

5.  交换机的**可用区**选择经典网络类型的ECS实例所在的可用区。

6.  完成其他基础配置项。

    具体说明请参见[搭建IPv4专有网络](/cn.zh-CN/快速入门/搭建IPv4专有网络.md)。

7.  单击**确定**。完成`VPC-1`的创建。


## 步骤二：经典网络迁移至专有网络

1.  登录[ECS管理控制台](https://ecs.console.aliyun.com)。

2.  在左侧导航栏，单击**实例与镜像** \> **实例**。

3.  在顶部菜单栏左上角处，选择地域。

4.  找到目标实例后，单击**更多** \> **网络和安全组** \> **预约迁移至专有网络** 。

5.  在弹出的对话框中，单击**确定**。

6.  单击**查看计划事件**，或在概览页面的左上方，单击**待处理事件**。

    **说明：** 后续的预约迁移步骤，暂时只支持使用主账号操作。

7.  在**待处理事件**页面，单击**预约迁移专有网络**页签。

8.  选择需要迁移的ECS实例，并单击**预约迁移**。

9.  在**预约迁移**对话框中，完成以下配置项，然后单击**确定**等待执行。

    -   **专有网络**与**虚拟交换机**：选择步骤一中已创建好的专有网络`VPC-1`及对应的交换机。
    -   **迁移后保留MAC**：请根据您的需求选择保留。
    -   **专有网络安全组**：您可以选择克隆经典网络类型的ECS实例的安全组，或着单击**新建安全组**前往创建。
    -   **预约日期**与**预约时间**：根据您的需求选择迁移执行的时间。预约时间不能早于当前时间，不能晚于最晚可预约时间。
    **说明：** 迁移后，经典网络类型的ECS实例的私网IP会改变。如果您的业务需要保持原有的私网IP，需要手动修改迁移后的ECS实例的私网IP。具体操作请参见[修改私有IP地址](/cn.zh-CN/网络/修改IPv4地址/修改私有IP地址.md)。


## 步骤三：创建并绑定云企业网

等待经典网络类型的ECS实例迁移网络完成后，需要完成以下操作实现`VPC-1`和`VPC-2`的网络互通。

1.  登录[云企业网控制台](https://cen.console.aliyun.com)。

2.  单击**创建云企业网实例**。

3.  在**加载网络实例**区域，完成以下配置项。

    -   **实例类型**：选择**专有网络（VPC）**
    -   **地域**：选择`VPC-1`所在的地域。例如：**华东2（上海）**
    -   **网络实例**：选择步骤一中创建的`VPC-1`
4.  完成其它基础配置项后，单击**确定**。

    详情请参见[创建CEN实例]()。

5.  登录[专有网络管理控制台](https://vpcnext.console.aliyun.com/vpc)。

6.  在顶部菜单栏处，选择ECS实例`ECS-3`的专有网络`VPC-2`所在的地域。

7.  找到`VPC-2`，并单击名称进入**专有网络详情**页面。

8.  单击**加入云企业网**，并选择已创建好的云企业网。


## 步骤四：验证互通性

通过以上三个步骤，即可实现`ECS-1`、`ECS-2`、`ECS-3`三台ECS实例的网络互通。由于`ECS-1`和`ECS-2`迁移至了同一个VPC下，所以两台ECS实例是内网互通的。您只需要远程连接使用`VPC-2`的ECS实例`ECS-3`，并运行以下命令，检查与其它两台ECS实例是否互通即可。

```
ping <ECS实例的私网IP>
```

例如，运行命令`ping 10.0.**.**`。正确的返回结果如下图所示。

![ping](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/1783420061/p166976.png)

